<<<<<<< HEAD
version: '3.8'

services:
  # --- INFRASTRUCTURE ---
  kafka:
    image: apache/kafka:latest
    ports:
      - "9092:9092"
    environment:
      - KAFKA_NODE_ID=1
      - KAFKA_PROCESS_ROLES=broker,controller
      - KAFKA_LISTENERS=PLAINTEXT://:9092,CONTROLLER://:9093
      - KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://kafka:9092
      - KAFKA_CONTROLLER_LISTENER_NAMES=CONTROLLER
      - KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT
      - KAFKA_CONTROLLER_QUORUM_VOTERS=1@kafka:9093
      - KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1
      - KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR=1
      - KAFKA_TRANSACTION_STATE_LOG_MIN_ISR=1
      - KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS=0
      - KAFKA_NUM_PARTITIONS=3
    healthcheck:
      test: [ "CMD-SHELL", "/opt/kafka/bin/kafka-broker-api-versions.sh --bootstrap-server localhost:9092" ]
      interval: 10s
      timeout: 10s
      retries: 5

  jaeger:
    image: jaegertracing/all-in-one:latest
    ports:
      - "16686:16686"
      - "4317:4317"
    environment:
      - COLLECTOR_OTLP_ENABLED=true

  otel-collector:
    image: otel/opentelemetry-collector-contrib:latest
    volumes:
      - ./infra/otel-config.yaml:/etc/otelcol-contrib/config.yaml
    ports:
      - "4318:4318"
    environment:
      - NEW_RELIC_LICENSE_KEY=${NEW_RELIC_LICENSE_KEY}
    depends_on:
      - jaeger

  chromadb:
    image: chromadb/chroma:latest
    ports:
      - "8000:8000"

  # --- MICROSERVICES ---
  quote-service:
    build: ./apps/quote-service
    ports:
      - "8001:8001"
    environment:
      - KAFKA_BOOTSTRAP_SERVERS=kafka:9092
      - OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4317
    depends_on:
      kafka:
        condition: service_healthy

  policy-service:
    build: ./apps/policy-service
    ports:
      - "8002:8002"
    environment:
      - KAFKA_BOOTSTRAP_SERVERS=kafka:9092
      - OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4317
    depends_on:
      kafka:
        condition: service_healthy

  user-service:
    build: ./apps/user-service
    ports:
      - "8003:8003"
    environment:
      - OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4317
    depends_on:
      - otel-collector

  frontend:
    build: ./apps/frontend
    ports:
      - "3001:80"
    depends_on:
      - quote-service

  # --- AGENTS (Final Unified Build) ---
  scout:
    build:
      context: .
      dockerfile: ./agents/Dockerfile
    dns:
      - 8.8.8.8
    command: [ "python", "agents/scout.py" ]
    environment:
      - GITHUB_PERSONAL_ACCESS_TOKEN=${GITHUB_PERSONAL_ACCESS_TOKEN}
      - KAFKA_BOOTSTRAP_SERVERS=kafka:9092
    depends_on:
      kafka:
        condition: service_healthy
    volumes:
      - history_data:/app/shared/history
      - .:/app

  brain:
    build:
      context: .
      dockerfile: ./agents/Dockerfile
    dns:
      - 8.8.8.8
    command: [ "python", "agents/brain.py" ]
    env_file: .env
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - history_data:/app/shared/history
      - .:/app

  memory:
    build:
      context: .
      dockerfile: ./agents/Dockerfile
    dns:
      - 8.8.8.8
    command: [ "python", "agents/memory.py" ]
    env_file: .env
    depends_on:
      - chromadb
    volumes:
      - history_data:/app/shared/history
      - .:/app

  fixer:
    build:
      context: .
      dockerfile: ./agents/Dockerfile
    dns:
      - 8.8.8.8
    command: [ "python", "agents/fixer.py" ]
    env_file: .env
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - .:/app/monorepo
      - history_data:/app/shared/history
      - .:/app
    depends_on:
      - brain

volumes:
  history_data:
=======
{
  "name": "docker-compose.yml",
  "path": "docker-compose.yml",
  "sha": "a4d9ef6f22d8e9c86b33fa8145c7e2719a82b84a",
  "size": 7042,
  "url": "https://api.github.com/repos/mohammedsalmanj/sre.space-cp/contents/docker-compose.yml?ref=main",
  "html_url": "https://github.com/mohammedsalmanj/sre.space-cp/blob/main/docker-compose.yml",
  "git_url": "https://api.github.com/repos/mohammedsalmanj/sre.space-cp/git/blobs/a4d9ef6f22d8e9c86b33fa8145c7e2719a82b84a",
  "download_url": "https://raw.githubusercontent.com/mohammedsalmanj/sre.space-cp/main/docker-compose.yml",
  "type": "file",
  "content": "{\n  \"name\": \"docker-compose.yml\",\n  \"path\": \"docker-compose.yml\",\n  \"sha\": \"c2ed70bf0897bee6c6d5672cc571ed4209a4f3b1\",\n  \"size\": 4988,\n  \"url\": \"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/contents/docker-compose.yml?ref=main\",\n  \"html_url\": \"https://github.com/mohammedsalmanj/sre.space-cp/blob/main/docker-compose.yml\",\n  \"git_url\": \"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/git/blobs/c2ed70bf0897bee6c6d5672cc571ed4209a4f3b1\",\n  \"download_url\": \"https://raw.githubusercontent.com/mohammedsalmanj/sre.space-cp/main/docker-compose.yml\",\n  \"type\": \"file\",\n  \"content\": \"{\\n  \\\"name\\\": \\\"docker-compose.yml\\\",\\n  \\\"path\\\": \\\"docker-compose.yml\\\",\\n  \\\"sha\\\": \\\"8090af52887ede8133ac47b3ee88aebef497b46e\\\",\\n  \\\"size\\\": 3470,\\n  \\\"url\\\": \\\"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/contents/docker-compose.yml?ref=main\\\",\\n  \\\"html_url\\\": \\\"https://github.com/mohammedsalmanj/sre.space-cp/blob/main/docker-compose.yml\\\",\\n  \\\"git_url\\\": \\\"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/git/blobs/8090af52887ede8133ac47b3ee88aebef497b46e\\\",\\n  \\\"download_url\\\": \\\"https://raw.githubusercontent.com/mohammedsalmanj/sre.space-cp/main/docker-compose.yml\\\",\\n  \\\"type\\\": \\\"file\\\",\\n  \\\"content\\\": \\\"{\\\\n  \\\\\\\"name\\\\\\\": \\\\\\\"docker-compose.yml\\\\\\\",\\\\n  \\\\\\\"path\\\\\\\": \\\\\\\"docker-compose.yml\\\\\\\",\\\\n  \\\\\\\"sha\\\\\\\": \\\\\\\"51d196c5ee820fc894ffecfdc535f82031a1b147\\\\\\\",\\\\n  \\\\\\\"size\\\\\\\": 2220,\\\\n  \\\\\\\"url\\\\\\\": \\\\\\\"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/contents/docker-compose.yml?ref=main\\\\\\\",\\\\n  \\\\\\\"html_url\\\\\\\": \\\\\\\"https://github.com/mohammedsalmanj/sre.space-cp/blob/main/docker-compose.yml\\\\\\\",\\\\n  \\\\\\\"git_url\\\\\\\": \\\\\\\"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/git/blobs/51d196c5ee820fc894ffecfdc535f82031a1b147\\\\\\\",\\\\n  \\\\\\\"download_url\\\\\\\": \\\\\\\"https://raw.githubusercontent.com/mohammedsalmanj/sre.space-cp/main/docker-compose.yml\\\\\\\",\\\\n  \\\\\\\"type\\\\\\\": \\\\\\\"file\\\\\\\",\\\\n  \\\\\\\"content\\\\\\\": \\\\\\\"{\\\\\\\\n  \\\\\\\\\\\\\\\"name\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\"docker-compose.yml\\\\\\\\\\\\\\\",\\\\\\\\n  \\\\\\\\\\\\\\\"path\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\"docker-compose.yml\\\\\\\\\\\\\\\",\\\\\\\\n  \\\\\\\\\\\\\\\"sha\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\"1c483d9735ada8ff6f3b371846ea60a13def4475\\\\\\\\\\\\\\\",\\\\\\\\n  \\\\\\\\\\\\\\\"size\\\\\\\\\\\\\\\": 1104,\\\\\\\\n  \\\\\\\\\\\\\\\"url\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/contents/docker-compose.yml?ref=main\\\\\\\\\\\\\\\",\\\\\\\\n  \\\\\\\\\\\\\\\"html_url\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\"https://github.com/mohammedsalmanj/sre.space-cp/blob/main/docker-compose.yml\\\\\\\\\\\\\\\",\\\\\\\\n  \\\\\\\\\\\\\\\"git_url\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/git/blobs/1c483d9735ada8ff6f3b371846ea60a13def4475\\\\\\\\\\\\\\\",\\\\\\\\n  \\\\\\\\\\\\\\\"download_url\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\"https://raw.githubusercontent.com/mohammedsalmanj/sre.space-cp/main/docker-compose.yml\\\\\\\\\\\\\\\",\\\\\\\\n  \\\\\\\\\\\\\\\"type\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\"file\\\\\\\\\\\\\\\",\\\\\\\\n  \\\\\\\\\\\\\\\"content\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\"{\\\\\\\\\\\\\\\\n  \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"name\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"docker-compose.yml\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\\n  \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"path\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"docker-compose.yml\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\\n  \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"sha\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"5c11ff1dd0341b8499ff55d56065103288c82c33\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\\n  \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"size\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\": 66,\\\\\\\\\\\\\\\\n  \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"url\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/contents/docker-compose.yml?ref=main\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\\n  \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"html_url\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"https://github.com/mohammedsalmanj/sre.space-cp/blob/main/docker-compose.yml\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\\n  \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"git_url\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/git/blobs/5c11ff1dd0341b8499ff55d56065103288c82c33\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\\n  \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"download_url\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"https://raw.githubusercontent.com/mohammedsalmanj/sre.space-cp/main/docker-compose.yml\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\\n  \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"type\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"file\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\\n  \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"content\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\n# Auto-Fix applied for Incident #108 at Wed Jan  7 01:23:52 2026\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\n\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\\n  \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"encoding\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"base64\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\\n  \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"_links\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\": {\\\\\\\\\\\\\\\\n    \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"self\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/contents/docker-compose.yml?ref=main\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\\n    \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"git\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/git/blobs/5c11ff1dd0341b8499ff55d56065103288c82c33\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\\n    \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"html\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"https://github.com/mohammedsalmanj/sre.space-cp/blob/main/docker-compose.yml\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"\\\\\\\\\\\\\\\\n  }\\\\\\\\\\\\\\\\n}\\\\\\\\\\\\\\\\n\\\\\\\\\\\\\\\\n# Auto-Fix applied for Incident #138 at Wed Jan  7 03:27:59 2026\\\\\\\\\\\\\\\\n\\\\\\\\\\\\\\\",\\\\\\\\n  \\\\\\\\\\\\\\\"encoding\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\"base64\\\\\\\\\\\\\\\",\\\\\\\\n  \\\\\\\\\\\\\\\"_links\\\\\\\\\\\\\\\": {\\\\\\\\n    \\\\\\\\\\\\\\\"self\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/contents/docker-compose.yml?ref=main\\\\\\\\\\\\\\\",\\\\\\\\n    \\\\\\\\\\\\\\\"git\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/git/blobs/1c483d9735ada8ff6f3b371846ea60a13def4475\\\\\\\\\\\\\\\",\\\\\\\\n    \\\\\\\\\\\\\\\"html\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\"https://github.com/mohammedsalmanj/sre.space-cp/blob/main/docker-compose.yml\\\\\\\\\\\\\\\"\\\\\\\\n  }\\\\\\\\n}\\\\\\\\n\\\\\\\\n# Auto-Fix applied for Incident #142 at Wed Jan  7 03:36:39 2026\\\\\\\\n\\\\\\\",\\\\n  \\\\\\\"encoding\\\\\\\": \\\\\\\"base64\\\\\\\",\\\\n  \\\\\\\"_links\\\\\\\": {\\\\n    \\\\\\\"self\\\\\\\": \\\\\\\"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/contents/docker-compose.yml?ref=main\\\\\\\",\\\\n    \\\\\\\"git\\\\\\\": \\\\\\\"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/git/blobs/51d196c5ee820fc894ffecfdc535f82031a1b147\\\\\\\",\\\\n    \\\\\\\"html\\\\\\\": \\\\\\\"https://github.com/mohammedsalmanj/sre.space-cp/blob/main/docker-compose.yml\\\\\\\"\\\\n  }\\\\n}\\\\n\\\\n# Auto-Fix applied for Incident #152 at Wed Jan  7 05:58:34 2026\\\\n\\\",\\n  \\\"encoding\\\": \\\"base64\\\",\\n  \\\"_links\\\": {\\n    \\\"self\\\": \\\"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/contents/docker-compose.yml?ref=main\\\",\\n    \\\"git\\\": \\\"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/git/blobs/8090af52887ede8133ac47b3ee88aebef497b46e\\\",\\n    \\\"html\\\": \\\"https://github.com/mohammedsalmanj/sre.space-cp/blob/main/docker-compose.yml\\\"\\n  }\\n}\\n\\n# Auto-Fix applied for Incident #157 at Wed Jan  7 06:18:01 2026\\n\",\n  \"encoding\": \"base64\",\n  \"_links\": {\n    \"self\": \"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/contents/docker-compose.yml?ref=main\",\n    \"git\": \"https://api.github.com/repos/mohammedsalmanj/sre.space-cp/git/blobs/c2ed70bf0897bee6c6d5672cc571ed4209a4f3b1\",\n    \"html\": \"https://github.com/mohammedsalmanj/sre.space-cp/blob/main/docker-compose.yml\"\n  }\n}\n\n# Auto-Fix applied for Incident #168 at Wed Jan  7 07:24:54 2026\n",
  "encoding": "base64",
  "_links": {
    "self": "https://api.github.com/repos/mohammedsalmanj/sre.space-cp/contents/docker-compose.yml?ref=main",
    "git": "https://api.github.com/repos/mohammedsalmanj/sre.space-cp/git/blobs/a4d9ef6f22d8e9c86b33fa8145c7e2719a82b84a",
    "html": "https://github.com/mohammedsalmanj/sre.space-cp/blob/main/docker-compose.yml"
  }
}

# Auto-Fix applied for Incident #171 at Wed Jan  7 07:51:38 2026
>>>>>>> 8164db505d2738f9c21ffe82a3586ff6240fdae1
