services:
  # --- SRE-Space Control Plane (The Engine) ---
  - type: web
    name: sre.space-cp
    env: docker
    region: oregon
    plan: free
    dockerFilePath: Dockerfile
    dockerContext: .
    healthCheckPath: /system/health
    autoDeploy: true
    envVars:
      - key: ENV
        value: cloud
      - key: LOG_LEVEL
        value: INFO
      - key: MAX_LLM_CONCURRENCY
        value: "1"
      - key: TRACE_SAMPLING_RATE
        value: "0.1"
      - key: MEMORY_THRESHOLD_MB
        value: "450"
      - key: REDIS_URL
        fromService:
          type: keyvalue
          name: sre-bus
          property: connectionString
      - key: OPENAI_API_KEY
        sync: false
      - key: GITHUB_PERSONAL_ACCESS_TOKEN
        sync: false

  # --- Managed Redis Event Bus ---
  - type: keyvalue
    name: sre-bus
    region: oregon
    plan: free
