<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRE-Space | Orbital Control Plane v3.6</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=JetBrains+Mono&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background: #020817;
            color: #f8fafc;
            background-image:
                radial-gradient(circle at 100% 0%, #0c4a6e 0%, transparent 50%),
                radial-gradient(circle at 0% 100%, #1e1b4b 0%, transparent 50%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .glass {
            background: rgba(15, 23, 42, 0.75);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5);
        }

        .terminal {
            font-family: 'JetBrains Mono', monospace;
            background: #010409;
            border: 1px solid #30363d;
            box-shadow: inset 0 0 100px rgba(0, 0, 0, 0.5);
        }

        .pulse {
            animation: pulse-animation 2s infinite;
        }

        @keyframes pulse-animation {
            0% {
                box-shadow: 0 0 0 0px rgba(34, 197, 94, 0.4);
            }

            100% {
                box-shadow: 0 0 0 10px rgba(34, 197, 94, 0);
            }
        }

        .agent-pill {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .agent-pill:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.1);
        }

        .stat-card {
            border-left: 4px solid #3b82f6;
        }

        .git-item {
            border-left: 4px solid #8b5cf6;
            animation: slideIn 0.5s ease-out;
        }

        .status-pill {
            padding: 2px 8px;
            border-radius: 9999px;
            font-size: 0.6rem;
            font-weight: 800;
            text-transform: uppercase;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 10px;
        }
    </style>
</head>

<body class="p-4 md:p-8 lg:p-12">
    <div class="max-w-[1400px] mx-auto">
        <!-- Header Section -->
        <header class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-12 gap-8">
            <div class="relative">
                <div class="absolute -left-4 top-0 w-1 h-12 bg-blue-500 rounded-full"></div>
                <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight">
                    <span
                        class="bg-gradient-to-r from-blue-400 via-indigo-400 to-purple-500 bg-clip-text text-transparent">SRE.Space</span>
                    <span class="text-slate-200">Orbital</span>
                </h1>
                <p class="text-slate-400 mt-2 text-lg font-medium">Cognitive Reliability Engine <span id="ui-version"
                        class="text-blue-500/80 mx-2">v3.6</span> <span id="runtime-clock"
                        class="text-slate-500 font-mono">00:00:00</span></p>
            </div>

            <!-- Real-time Stats Bar -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 w-full lg:w-auto">
                <div class="glass px-6 py-4 stat-card">
                    <div class="text-[10px] uppercase text-slate-500 font-black tracking-tighter mb-1">Runtime Env</div>
                    <div id="stat-mode" class="text-lg font-bold text-blue-400 tabular-nums">---</div>
                </div>
                <div class="glass px-6 py-4 stat-card" style="border-left-color: #10b981;">
                    <div class="text-[10px] uppercase text-slate-500 font-black tracking-tighter mb-1">Active Memory
                    </div>
                    <div id="stat-mem" class="text-lg font-bold text-green-400 tabular-nums">---</div>
                </div>
                <div class="glass px-6 py-4 stat-card" style="border-left-color: #f59e0b;">
                    <div class="text-[10px] uppercase text-slate-500 font-black tracking-tighter mb-1">System Health
                    </div>
                    <div class="flex items-center gap-2">
                        <div id="status-dot" class="w-2 h-2 bg-green-500 rounded-full pulse"></div>
                        <div id="stat-status" class="text-sm font-bold text-green-400 uppercase">Healthy</div>
                    </div>
                </div>
                <div class="glass px-6 py-4 stat-card" style="border-left-color: #8b5cf6;">
                    <div class="text-[10px] uppercase text-slate-500 font-black tracking-tighter mb-1">Latency Layer
                    </div>
                    <div id="stat-bus" class="text-lg font-bold text-purple-400 tabular-nums">---</div>
                </div>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <!-- Left Panel: Agents -->
            <div class="lg:col-span-3 space-y-6">
                <h3 class="text-sm font-black text-slate-500 uppercase tracking-[0.2em] px-2 text-center lg:text-left">
                    SRE Specialist Squad</h3>
                <div class="grid grid-cols-1 gap-3">
                    <!-- Agent Pills -->
                    <div class="glass p-4 flex items-center gap-4 agent-pill group border border-green-500/20">
                        <div class="w-10 h-10 rounded-xl bg-green-500/10 flex items-center justify-center text-xl">üïµÔ∏è
                        </div>
                        <div class="flex-1">
                            <div class="text-sm font-bold text-slate-200">Scout</div>
                            <div class="text-[10px] text-slate-500 uppercase font-bold tracking-widest">OTel Watchdog
                            </div>
                        </div>
                    </div>
                    <div class="glass p-4 flex items-center gap-4 agent-pill group border border-purple-500/20">
                        <div class="w-10 h-10 rounded-xl bg-purple-500/10 flex items-center justify-center text-xl">üß†
                        </div>
                        <div class="flex-1">
                            <div class="text-sm font-bold text-slate-200">Brain</div>
                            <div class="text-[10px] text-slate-500 uppercase font-bold tracking-widest">RCA Reasoning
                            </div>
                        </div>
                    </div>
                    <div class="glass p-4 flex items-center gap-4 agent-pill group border border-orange-500/20">
                        <div class="w-10 h-10 rounded-xl bg-orange-500/10 flex items-center justify-center text-xl">üõ†Ô∏è
                        </div>
                        <div class="flex-1">
                            <div class="text-sm font-bold text-slate-200">Fixer</div>
                            <div class="text-[10px] text-slate-500 uppercase font-bold tracking-widest">GitOps Engine
                            </div>
                        </div>
                    </div>
                    <div class="glass p-4 flex items-center gap-4 agent-pill group border border-blue-500/20">
                        <div class="w-10 h-10 rounded-xl bg-blue-500/10 flex items-center justify-center text-xl">ü§ñ
                        </div>
                        <div class="flex-1">
                            <div class="text-sm font-bold text-slate-200">Jules</div>
                            <div class="text-[10px] text-slate-500 uppercase font-bold tracking-widest">Arch Optimizer
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass p-6 mt-4 border border-blue-500/20">
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-[0.2em] mb-4">Autonomous Controls
                    </h3>
                    <div class="space-y-3">
                        <button onclick="triggerDemo('infra')"
                            class="w-full py-3 bg-blue-500/10 hover:bg-blue-500/20 border border-blue-500/30 text-blue-400 font-bold rounded-xl transition text-sm flex items-center justify-center gap-2">
                            üåÄ Trigger Infra Scale
                        </button>
                        <button onclick="triggerDemo('code')"
                            class="w-full py-3 bg-purple-500/10 hover:bg-purple-500/20 border border-purple-500/30 text-purple-400 font-bold rounded-xl transition text-sm flex items-center justify-center gap-2">
                            ‚ö° Trigger Logic Patch
                        </button>
                    </div>
                </div>
            </div>

            <!-- Center Panel: Terminal -->
            <div class="lg:col-span-6">
                <div class="terminal rounded-3xl h-[650px] flex flex-col overflow-hidden shadow-2xl">
                    <div class="bg-slate-900/50 px-6 py-4 flex justify-between items-center border-b border-slate-800">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 bg-red-500/20 rounded-full"></div>
                            <div class="w-3 h-3 bg-yellow-500/20 rounded-full"></div>
                            <div class="w-3 h-3 bg-green-500/20 rounded-full"></div>
                            <span
                                class="ml-2 text-[10px] font-bold text-slate-500 tracking-widest">COGNITIVE_LOOP_STREAM</span>
                        </div>
                        <div id="loader" class="hidden flex items-center gap-2">
                            <span class="text-[10px] font-bold text-blue-500 animate-pulse">PROCESSING RCA</span>
                            <div class="w-1 h-4 bg-blue-500 animate-bounce"></div>
                        </div>
                    </div>
                    <div id="logs" class="p-8 overflow-y-auto flex-1 space-y-4 scroll-smooth">
                        <div class="text-slate-600 font-mono text-sm italic">// Initializing cognitive uplink... systems
                            nominal.</div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Real-time GitOps feed -->
            <div class="lg:col-span-3 space-y-6">
                <h3 class="text-sm font-black text-slate-500 uppercase tracking-[0.2em] px-2 text-center lg:text-left">
                    Live GitOps Intelligence</h3>
                <div id="git-activity" class="space-y-4">
                    <!-- Git Items will be injected here -->
                    <div class="text-center py-12 text-slate-600 italic text-xs">Fetching GitHub history...</div>
                </div>

                <div class="glass p-6 border border-indigo-500/20 bg-indigo-500/5">
                    <h4 class="text-[10px] font-black text-indigo-400 uppercase tracking-widest mb-2">Memory Insight
                        (RAG)</h4>
                    <p class="text-[11px] text-slate-400 italic">"Autonomous engine matches current latency pattern to
                        ChromaDB entry #INC-882. Confidence 97%."</p>
                </div>
            </div>
        </main>

        <footer class="mt-16 text-center text-slate-600 text-[10px] font-bold uppercase tracking-[0.4em]">
            Galaxy-Scale Reliability Engine | Built for 100% Autonomy
        </footer>
    </div>

    <script>
        const logBox = document.getElementById('logs');
        const loader = document.getElementById('loader');
        const gitBox = document.getElementById('git-activity');

        function updateClock() {
            document.getElementById('runtime-clock').innerText = new Date().toLocaleTimeString();
        }
        setInterval(updateClock, 1000);
        updateClock();

        async function updateStats() {
            try {
                const res = await fetch('/system/health');
                const data = await res.json();
                document.getElementById('stat-mode').innerText = data.mode.toUpperCase();
                document.getElementById('stat-mem').innerText = data.memory.memory_percent + '%';
                document.getElementById('stat-bus').innerText = data.event_bus.toUpperCase();

                if (data.status === 'degraded') {
                    document.getElementById('stat-status').innerText = 'DEGRADED';
                    document.getElementById('stat-status').className = 'text-sm font-bold text-amber-500 uppercase';
                    document.getElementById('status-dot').className = 'w-2 h-2 bg-amber-500 rounded-full pulse';
                } else {
                    document.getElementById('stat-status').innerText = 'HEALTHY';
                    document.getElementById('stat-status').className = 'text-sm font-bold text-green-400 uppercase';
                    document.getElementById('status-dot').className = 'w-2 h-2 bg-green-500 rounded-full pulse';
                }
            } catch (err) { }
        }

        async function updateGitActivity() {
            try {
                const res = await fetch('/api/git-activity');
                const data = await res.json();
                if (data.error) throw new Error(data.error);

                gitBox.innerHTML = '';
                data.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'glass p-4 git-item bg-slate-800/20 group hover:bg-slate-800/40 transition-all';
                    const color = item.state === 'open' ? 'indigo-400' : 'green-400';
                    const bgColor = item.state === 'open' ? 'indigo-500/20' : 'green-500/20';
                    const icon = item.type === 'pull_request' ? '‚öîÔ∏è' : 'üö®';

                    div.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] font-black text-${color}">#${item.number}</span>
                            <span class="status-pill bg-${bgColor} text-${color}">${item.state}</span>
                        </div>
                        <div class="text-[11px] font-bold text-slate-200 line-clamp-2">${icon} ${item.title}</div>
                        <div class="text-[9px] text-slate-500 mt-2 font-mono uppercase tracking-tighter">Created: ${new Date(item.created_at).toLocaleDateString()}</div>
                    `;
                    gitBox.appendChild(div);
                });
            } catch (err) {
                gitBox.innerHTML = '<div class="text-slate-700 text-[10px] text-center italic">Failed to sync GitHub feed</div>';
            }
        }

        setInterval(updateStats, 5000);
        setInterval(updateGitActivity, 15000); // Pulse GitHub every 15s
        updateStats();
        updateGitActivity();

        function addLog(msg) {
            const div = document.createElement('div');
            div.className = "text-sm font-mono leading-relaxed border-l-2 border-slate-800 pl-4 py-1";

            let color = "text-slate-300";
            if (msg.includes('Scout')) color = "text-green-400";
            else if (msg.includes('Brain')) color = "text-purple-400";
            else if (msg.includes('Guardrail')) color = "text-amber-400";
            else if (msg.includes('Fixer')) color = "text-orange-400";
            else if (msg.includes('Jules')) color = "text-blue-400";
            else if (msg.includes('System')) color = "text-slate-500";

            div.innerHTML = `<span class="opacity-30 text-[10px] mr-2">‚ûú</span><span class="${color}">${msg}</span>`;
            logBox.appendChild(div);
            logBox.scrollTop = logBox.scrollHeight;
        }

        async function triggerDemo(type) {
            logBox.innerHTML = '<div class="text-slate-600 font-mono text-xs italic">// Initiating autonomous repair cycle...</div>';
            loader.classList.remove('hidden');

            const eventSource = new EventSource(`/api/sre-loop?anomaly=true&type=${type}`);

            eventSource.onmessage = (event) => {
                const data = JSON.parse(event.data);
                addLog(data.message);

                if (data.final_state) {
                    eventSource.close();
                    loader.classList.add('hidden');
                    updateStats();
                    setTimeout(updateGitActivity, 2000); // Refresh Git feed right after loop
                }
            };

            eventSource.onerror = () => {
                eventSource.close();
                loader.classList.add('hidden');
            };
        }
    </script>
</body>

</html>