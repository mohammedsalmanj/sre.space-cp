<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRE-Space | Premium Insurance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background: #020617;
            color: #f8fafc;
            min-height: 100vh;
        }

        .glass {
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 2rem;
            transition: all 0.3s;
        }

        .glass:hover {
            transform: translateY(-8px);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .cta-button {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        }

        .chaos-btn {
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .chaos-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            border-color: #ef4444;
        }
    </style>
</head>

<body class="p-6 md:p-20">
    <div class="max-w-6xl mx-auto">
        <header class="flex justify-between items-center mb-24">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-600 rounded-2xl flex items-center justify-center font-black text-xl">S
                </div>
                <span class="text-2xl font-black tracking-tighter uppercase italic">SRE-Space</span>
            </div>
            <div id="system-status"
                class="flex items-center gap-2 px-4 py-2 bg-slate-900 rounded-full border border-slate-800">
                <span class="w-2 h-2 rounded-full bg-green-500"></span>
                <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">System Nominal</span>
            </div>
        </header>

        <main class="text-center mb-32">
            <h2 class="text-5xl md:text-7xl font-bold mb-6 tracking-tight leading-none">Protecting What <br /><span
                    class="text-blue-500">Matters.</span></h2>
            <p class="text-slate-400 text-lg max-w-2xl mx-auto mb-12">The first autonomous insurance marketplace.
                High-performance policies under the watch of an 8-agent SRE squad.</p>
        </main>

        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-20">
            <div class="glass p-10 flex flex-col items-center text-center">
                <div class="text-5xl mb-6">üíé</div>
                <h3 class="text-xl font-bold mb-3">Health Premium</h3>
                <p class="text-slate-400 text-sm mb-8">Unlimited coverage for digital healthcare and telemetry-backed
                    claims.</p>
                <button onclick="getQuote()"
                    class="w-full py-4 rounded-xl font-black text-xs uppercase tracking-widest cta-button">Get
                    Quote</button>
            </div>
            <div class="glass p-10 flex flex-col items-center text-center">
                <div class="text-5xl mb-6">üèòÔ∏è</div>
                <h3 class="text-xl font-bold mb-3">Property Guard</h3>
                <p class="text-slate-400 text-sm mb-8">Smart home monitoring integrated with autonomous repair squads.
                </p>
                <button onclick="getQuote()"
                    class="w-full py-4 rounded-xl font-black text-xs uppercase tracking-widest cta-button">Get
                    Quote</button>
            </div>
            <div class="glass p-10 flex flex-col items-center text-center">
                <div class="text-5xl mb-6">üöó</div>
                <h3 class="text-xl font-bold mb-3">Auto Mobility</h3>
                <p class="text-slate-400 text-sm mb-8">Dynamic pricing based on real-time driving telemetry and risk
                    analysis.</p>
                <button onclick="getQuote()"
                    class="w-full py-4 rounded-xl font-black text-xs uppercase tracking-widest cta-button">Get
                    Quote</button>
            </div>
        </section>

        <!-- Chaos Engineering Panel (For Demos) -->
        <div class="max-w-4xl mx-auto space-y-6">
            <h4 class="text-[10px] font-black text-slate-500 uppercase tracking-widest text-center">Chaos Engineering
                Dashboard</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button onclick="injectChaos('500')" class="glass p-6 text-left chaos-btn group">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-black text-red-500 uppercase">Inject 500 Errors</span>
                        <span class="text-lg group-hover:rotate-12 transition">üö®</span>
                    </div>
                    <p class="text-[10px] text-slate-500">Triggers 'Database pool exhausted' anomaly in the Quote
                        Service.</p>
                </button>
                <button onclick="injectChaos('latency')" class="glass p-6 text-left chaos-btn group">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-black text-amber-500 uppercase">Inject Latency</span>
                        <span class="text-lg group-hover:scale-110 transition">‚è≥</span>
                    </div>
                    <p class="text-[10px] text-slate-500">Forces >2.5s delay on all quote calculations. Tests timeout
                        alerts.</p>
                </button>
            </div>
        </div>
    </div>

    <!-- Processing Overlay -->
    <div id="overlay"
        class="fixed inset-0 bg-slate-950/90 z-50 flex items-center justify-center hidden backdrop-blur-lg">
        <div class="text-center max-w-md p-8">
            <div id="loader"
                class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-8">
            </div>
            <h2 id="modal-title" class="text-2xl font-black mb-4 italic tracking-tight">Processing Request...</h2>
            <div id="quote-result" class="hidden glass p-6 mb-8 text-left space-y-2">
                <div class="flex justify-between border-b border-slate-700 pb-2 mb-2">
                    <span class="text-[10px] font-black uppercase text-slate-500">Quote ID</span>
                    <span id="res-id" class="text-xs font-bold text-white">---</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-[10px] font-black uppercase text-slate-500">Monthly Premium</span>
                    <span id="res-price" class="text-xs font-black text-blue-400">---</span>
                </div>
            </div>
            <div id="anomaly-report" class="hidden glass p-6 mb-8 text-left border-red-500/30 bg-red-500/5">
                <div class="text-[10px] font-black text-red-500 uppercase mb-2">SRE System Alert</div>
                <p id="anomaly-msg" class="text-xs text-slate-300 italic mb-4">Detection in progress...</p>
                <div id="agent-logs" class="text-[9px] font-mono text-blue-400 space-y-1 opacity-80"></div>
            </div>
            <button onclick="closeModal()"
                class="text-[10px] font-black text-slate-500 hover:text-white uppercase tracking-widest transition">Close
                View</button>
        </div>
    </div>

    <script>
        async function getQuote() {
            const overlay = document.getElementById('overlay');
            const quoteRes = document.getElementById('quote-result');
            const anomalyReport = document.getElementById('anomaly-report');
            const title = document.getElementById('modal-title');
            const loader = document.getElementById('loader');

            overlay.classList.remove('hidden');
            quoteRes.classList.add('hidden');
            anomalyReport.classList.add('hidden');
            title.innerText = "Processing Quote Request...";
            loader.classList.remove('hidden');

            try {
                const res = await fetch('/quote');
                const data = await res.json();

                if (res.ok) {
                    loader.classList.add('hidden');
                    title.innerText = "Quote Generated Successfully";
                    document.getElementById('res-id').innerText = data.quote_id;
                    document.getElementById('res-price').innerText = `$${data.price}.00`;
                    quoteRes.classList.remove('hidden');
                } else {
                    throw new Error(data.detail || "Service Error");
                }
            } catch (err) {
                loader.classList.add('hidden');
                title.innerText = "System Anomaly Detected";
                title.className = "text-2xl font-black mb-4 italic tracking-tight text-red-500";
                anomalyReport.classList.remove('hidden');
                document.getElementById('anomaly-msg').innerText = err.message;
                startAgentStream();
            }
        }

        function startAgentStream() {
            const logs = document.getElementById('agent-logs');
            logs.innerHTML = '<p>‚ö° SRE Squad Notified. Engaging loops...</p>';

            const eventSource = new EventSource('/api/sre-loop?anomaly=false');
            eventSource.onmessage = (e) => {
                const data = JSON.parse(e.data);
                if (data.message) {
                    const p = document.createElement('p');
                    p.innerText = `¬ª ${data.message}`;
                    logs.appendChild(p);
                }
                if (data.final_state) {
                    eventSource.close();
                    const p = document.createElement('p');
                    p.className = "text-green-400 font-bold mt-2";
                    p.innerText = "‚úì SYSTEM RESTORED BY SRE-SPACE";
                    logs.appendChild(p);
                }
            };
        }

        async function injectChaos(type) {
            const status = document.getElementById('system-status');
            status.innerHTML = `<span class="w-2 h-2 rounded-full bg-red-500"></span><span class="text-[10px] font-bold text-red-400 uppercase tracking-widest">Injected: ${type.toUpperCase()}</span>`;
            await fetch(`/demo/inject-failure?type=${type}`, { method: 'POST' });
        }

        function closeModal() {
            document.getElementById('overlay').classList.add('hidden');
            document.getElementById('modal-title').className = "text-2xl font-black mb-4 italic tracking-tight text-white";
        }
    </script>
</body>

</html>